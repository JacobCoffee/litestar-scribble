<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>scribbl_py.game.models - scribbl-py</title><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=14737038" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_paramlinks.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=fc559bc7" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="scribbl_py.game.models"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../../index.html">
      
      
      <strong>scribbl-py</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link">
          <a href="https://litestar.dev/">
            <span>Litestar</span></a>
        </li><li class="link">
          <a href="https://pypi.org/project/scribbl-py/">
            <span>PyPI</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/JacobCoffee/scribbl-py" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Learn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started/quickstart.html">Quickstart</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../guides/configuration.html">Configuration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guides/development.html">Development Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guides/deployment.html">Deployment Guide</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/plugin.html">Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/core.html">Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/storage.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/realtime.html">Realtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/auth.html">Auth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/web.html">Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/game.html">Game</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/JacobCoffee/scribbl-py">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/litestar">Discord</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">scribbl-py</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">scribbl_py.game.models</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for scribbl_py.game.models</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="sd">&quot;&quot;&quot;Game mode data models for CanvasClash Mode.</span>
</span><span data-line="2">
</span><span data-line="3"><span class="sd">This module defines the core data structures for the drawing guessing game mode,</span>
</span><span data-line="4"><span class="sd">including game rooms, players, rounds, word banks, and game state management.</span>
</span><span data-line="5"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="6">
</span><span data-line="7"><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
</span><span data-line="8">
</span><span data-line="9"><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span data-line="10"><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span data-line="11"><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
</span><span data-line="12"><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
</span><span data-line="13"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">UTC</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="14"><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">StrEnum</span>
</span><span data-line="15"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span data-line="16"><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">uuid4</span>
</span><span data-line="17">
</span><span data-line="18">
<div class="viewcode-block" id="GameState">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameState">[docs]</a>
</span><span data-line="19"><span class="k">class</span><span class="w"> </span><span class="nc">GameState</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
</span><span data-line="20"><span class="w">    </span><span class="sd">&quot;&quot;&quot;State of the game room.</span>
</span><span data-line="21">
</span><span data-line="22"><span class="sd">    The game progresses through these states in order:</span>
</span><span data-line="23"><span class="sd">    LOBBY -&gt; WORD_SELECTION -&gt; DRAWING -&gt; ROUND_END -&gt; (repeat or GAME_OVER)</span>
</span><span data-line="24"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="25">
</span><span data-line="26">    <span class="n">LOBBY</span> <span class="o">=</span> <span class="s2">&quot;lobby&quot;</span>  <span class="c1"># Waiting for players to join and host to start</span>
</span><span data-line="27">    <span class="n">WORD_SELECTION</span> <span class="o">=</span> <span class="s2">&quot;word_selection&quot;</span>  <span class="c1"># Drawer is choosing a word</span>
</span><span data-line="28">    <span class="n">DRAWING</span> <span class="o">=</span> <span class="s2">&quot;drawing&quot;</span>  <span class="c1"># Active drawing round, players guessing</span>
</span><span data-line="29">    <span class="n">ROUND_END</span> <span class="o">=</span> <span class="s2">&quot;round_end&quot;</span>  <span class="c1"># Round finished, showing results</span>
</span><span data-line="30">    <span class="n">GAME_OVER</span> <span class="o">=</span> <span class="s2">&quot;game_over&quot;</span>  <span class="c1"># All rounds complete, final scores</span></div>

</span><span data-line="31">
</span><span data-line="32">
<div class="viewcode-block" id="GameMode">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameMode">[docs]</a>
</span><span data-line="33"><span class="k">class</span><span class="w"> </span><span class="nc">GameMode</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
</span><span data-line="34"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Available game modes.&quot;&quot;&quot;</span>
</span><span data-line="35">
</span><span data-line="36">    <span class="n">SKRIBBL</span> <span class="o">=</span> <span class="s2">&quot;skribbl&quot;</span>  <span class="c1"># Drawing guessing game</span>
</span><span data-line="37">    <span class="n">COLLABORATIVE</span> <span class="o">=</span> <span class="s2">&quot;collaborative&quot;</span>  <span class="c1"># Free-form collaborative whiteboard</span></div>

</span><span data-line="38">
</span><span data-line="39">
<div class="viewcode-block" id="PlayerState">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.PlayerState">[docs]</a>
</span><span data-line="40"><span class="k">class</span><span class="w"> </span><span class="nc">PlayerState</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
</span><span data-line="41"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Connection state of a player.&quot;&quot;&quot;</span>
</span><span data-line="42">
</span><span data-line="43">    <span class="n">CONNECTED</span> <span class="o">=</span> <span class="s2">&quot;connected&quot;</span>  <span class="c1"># Active connection</span>
</span><span data-line="44">    <span class="n">DISCONNECTED</span> <span class="o">=</span> <span class="s2">&quot;disconnected&quot;</span>  <span class="c1"># Temporarily disconnected</span>
</span><span data-line="45">    <span class="n">LEFT</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>  <span class="c1"># Permanently left the game</span></div>

</span><span data-line="46">
</span><span data-line="47">
<div class="viewcode-block" id="WordCategory">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.WordCategory">[docs]</a>
</span><span data-line="48"><span class="k">class</span><span class="w"> </span><span class="nc">WordCategory</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
</span><span data-line="49"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Categories for word banks.&quot;&quot;&quot;</span>
</span><span data-line="50">
</span><span data-line="51">    <span class="n">ANIMALS</span> <span class="o">=</span> <span class="s2">&quot;animals&quot;</span>
</span><span data-line="52">    <span class="n">OBJECTS</span> <span class="o">=</span> <span class="s2">&quot;objects&quot;</span>
</span><span data-line="53">    <span class="n">ACTIONS</span> <span class="o">=</span> <span class="s2">&quot;actions&quot;</span>
</span><span data-line="54">    <span class="n">FOOD</span> <span class="o">=</span> <span class="s2">&quot;food&quot;</span>
</span><span data-line="55">    <span class="n">PLACES</span> <span class="o">=</span> <span class="s2">&quot;places&quot;</span>
</span><span data-line="56">    <span class="n">PEOPLE</span> <span class="o">=</span> <span class="s2">&quot;people&quot;</span>
</span><span data-line="57">    <span class="n">NATURE</span> <span class="o">=</span> <span class="s2">&quot;nature&quot;</span>
</span><span data-line="58">    <span class="n">TECHNOLOGY</span> <span class="o">=</span> <span class="s2">&quot;technology&quot;</span>
</span><span data-line="59">    <span class="n">SPORTS</span> <span class="o">=</span> <span class="s2">&quot;sports&quot;</span>
</span><span data-line="60">    <span class="n">ENTERTAINMENT</span> <span class="o">=</span> <span class="s2">&quot;entertainment&quot;</span>
</span><span data-line="61">    <span class="n">CUSTOM</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>  <span class="c1"># User-defined words</span></div>

</span><span data-line="62">
</span><span data-line="63">
<div class="viewcode-block" id="ChatMessageType">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.ChatMessageType">[docs]</a>
</span><span data-line="64"><span class="k">class</span><span class="w"> </span><span class="nc">ChatMessageType</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
</span><span data-line="65"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Type of chat message.&quot;&quot;&quot;</span>
</span><span data-line="66">
</span><span data-line="67">    <span class="n">GUESS</span> <span class="o">=</span> <span class="s2">&quot;guess&quot;</span>  <span class="c1"># Player guess attempt</span>
</span><span data-line="68">    <span class="n">SYSTEM</span> <span class="o">=</span> <span class="s2">&quot;system&quot;</span>  <span class="c1"># System notification (user joined/left, etc.)</span>
</span><span data-line="69">    <span class="n">HINT</span> <span class="o">=</span> <span class="s2">&quot;hint&quot;</span>  <span class="c1"># Close guess hint</span>
</span><span data-line="70">    <span class="n">CORRECT</span> <span class="o">=</span> <span class="s2">&quot;correct&quot;</span>  <span class="c1"># Correct guess notification</span>
</span><span data-line="71">    <span class="n">DRAWER</span> <span class="o">=</span> <span class="s2">&quot;drawer&quot;</span>  <span class="c1"># Message from drawer (only when round ends)</span></div>

</span><span data-line="72">
</span><span data-line="73">
<div class="viewcode-block" id="GuessResult">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GuessResult">[docs]</a>
</span><span data-line="74"><span class="k">class</span><span class="w"> </span><span class="nc">GuessResult</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
</span><span data-line="75"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Result of a guess attempt.&quot;&quot;&quot;</span>
</span><span data-line="76">
</span><span data-line="77">    <span class="n">CORRECT</span> <span class="o">=</span> <span class="s2">&quot;correct&quot;</span>  <span class="c1"># Exact match</span>
</span><span data-line="78">    <span class="n">CLOSE</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span>  <span class="c1"># Close to the word (Levenshtein distance)</span>
</span><span data-line="79">    <span class="n">WRONG</span> <span class="o">=</span> <span class="s2">&quot;wrong&quot;</span>  <span class="c1"># Not close</span>
</span><span data-line="80">    <span class="n">ALREADY_GUESSED</span> <span class="o">=</span> <span class="s2">&quot;already_guessed&quot;</span>  <span class="c1"># Player already guessed correctly</span>
</span><span data-line="81">    <span class="n">DRAWER</span> <span class="o">=</span> <span class="s2">&quot;drawer&quot;</span>  <span class="c1"># Drawer cannot guess</span>
</span><span data-line="82">    <span class="n">INVALID</span> <span class="o">=</span> <span class="s2">&quot;invalid&quot;</span>  <span class="c1"># Invalid guess (too short, etc.)</span></div>

</span><span data-line="83">
</span><span data-line="84">
<div class="viewcode-block" id="Player">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Player">[docs]</a>
</span><span data-line="85"><span class="nd">@dataclass</span>
</span><span data-line="86"><span class="k">class</span><span class="w"> </span><span class="nc">Player</span><span class="p">:</span>
</span><span data-line="87"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a player in the game room.</span>
</span><span data-line="88">
</span><span data-line="89"><span class="sd">    Tracks player identity, score, connection state, and game progress.</span>
</span><span data-line="90">
</span><span data-line="91"><span class="sd">    Attributes:</span>
</span><span data-line="92"><span class="sd">        id: Unique identifier for the player.</span>
</span><span data-line="93"><span class="sd">        user_id: User ID from the session/auth system.</span>
</span><span data-line="94"><span class="sd">        user_name: Display name shown to other players.</span>
</span><span data-line="95"><span class="sd">        avatar_url: Optional URL to player&#39;s avatar image.</span>
</span><span data-line="96"><span class="sd">        score: Current total score across all rounds.</span>
</span><span data-line="97"><span class="sd">        is_host: Whether this player is the room host.</span>
</span><span data-line="98"><span class="sd">        is_spectator: Whether this player is a spectator (cannot draw/guess).</span>
</span><span data-line="99"><span class="sd">        connection_state: Current connection status.</span>
</span><span data-line="100"><span class="sd">        has_guessed: Whether player has guessed correctly in current round.</span>
</span><span data-line="101"><span class="sd">        guess_time: Time taken to guess (for scoring calculation).</span>
</span><span data-line="102"><span class="sd">        joined_at: When the player joined the room.</span>
</span><span data-line="103"><span class="sd">        last_seen: Last activity timestamp for connection tracking.</span>
</span><span data-line="104"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="105">
</span><span data-line="106">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="107">    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="108">    <span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Anonymous&quot;</span>
</span><span data-line="109">    <span class="n">avatar_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="110">    <span class="n">score</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="111">    <span class="n">is_host</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="112">    <span class="n">is_spectator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="113">    <span class="n">connection_state</span><span class="p">:</span> <span class="n">PlayerState</span> <span class="o">=</span> <span class="n">PlayerState</span><span class="o">.</span><span class="n">CONNECTED</span>
</span><span data-line="114">    <span class="n">has_guessed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="115">    <span class="n">guess_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="116">    <span class="n">joined_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span>
</span><span data-line="117">    <span class="n">last_seen</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span>
</span><span data-line="118">
<div class="viewcode-block" id="Player.reset_round_state">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Player.reset_round_state">[docs]</a>
</span><span data-line="119">    <span class="k">def</span><span class="w"> </span><span class="nf">reset_round_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="120"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset per-round state (has_guessed, guess_time).&quot;&quot;&quot;</span>
</span><span data-line="121">        <span class="bp">self</span><span class="o">.</span><span class="n">has_guessed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="122">        <span class="bp">self</span><span class="o">.</span><span class="n">guess_time</span> <span class="o">=</span> <span class="kc">None</span></div>

</span><span data-line="123">
<div class="viewcode-block" id="Player.award_points">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Player.award_points">[docs]</a>
</span><span data-line="124">    <span class="k">def</span><span class="w"> </span><span class="nf">award_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="125"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add points to player&#39;s total score.</span>
</span><span data-line="126">
</span><span data-line="127"><span class="sd">        Args:</span>
</span><span data-line="128"><span class="sd">            points: Number of points to award.</span>
</span><span data-line="129"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="130">        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">points</span></div>

</span><span data-line="131">
<div class="viewcode-block" id="Player.mark_active">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Player.mark_active">[docs]</a>
</span><span data-line="132">    <span class="k">def</span><span class="w"> </span><span class="nf">mark_active</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="133"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update last_seen timestamp to current time.&quot;&quot;&quot;</span>
</span><span data-line="134">        <span class="bp">self</span><span class="o">.</span><span class="n">last_seen</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span></div>
</div>

</span><span data-line="135">
</span><span data-line="136">
<div class="viewcode-block" id="WordBank">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.WordBank">[docs]</a>
</span><span data-line="137"><span class="nd">@dataclass</span>
</span><span data-line="138"><span class="k">class</span><span class="w"> </span><span class="nc">WordBank</span><span class="p">:</span>
</span><span data-line="139"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collection of words organized by category.</span>
</span><span data-line="140">
</span><span data-line="141"><span class="sd">    Attributes:</span>
</span><span data-line="142"><span class="sd">        id: Unique identifier for the word bank.</span>
</span><span data-line="143"><span class="sd">        name: Display name for the word bank.</span>
</span><span data-line="144"><span class="sd">        category: Category this word bank belongs to.</span>
</span><span data-line="145"><span class="sd">        words: List of words available for selection.</span>
</span><span data-line="146"><span class="sd">        difficulty: Difficulty level (1-5, affects scoring).</span>
</span><span data-line="147"><span class="sd">        is_default: Whether this is a built-in word bank.</span>
</span><span data-line="148"><span class="sd">        created_by: User ID of creator (for custom word banks).</span>
</span><span data-line="149"><span class="sd">        created_at: When the word bank was created.</span>
</span><span data-line="150"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="151">
</span><span data-line="152">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="153">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Default Words&quot;</span>
</span><span data-line="154">    <span class="n">category</span><span class="p">:</span> <span class="n">WordCategory</span> <span class="o">=</span> <span class="n">WordCategory</span><span class="o">.</span><span class="n">OBJECTS</span>
</span><span data-line="155">    <span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="156">    <span class="n">difficulty</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 1-5 scale</span>
</span><span data-line="157">    <span class="n">is_default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="158">    <span class="n">created_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="159">    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span>
</span><span data-line="160">
<div class="viewcode-block" id="WordBank.get_random_words">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.WordBank.get_random_words">[docs]</a>
</span><span data-line="161">    <span class="k">def</span><span class="w"> </span><span class="nf">get_random_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span data-line="162"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get random words for selection.</span>
</span><span data-line="163">
</span><span data-line="164"><span class="sd">        Args:</span>
</span><span data-line="165"><span class="sd">            count: Number of random words to return.</span>
</span><span data-line="166">
</span><span data-line="167"><span class="sd">        Returns:</span>
</span><span data-line="168"><span class="sd">            List of random words from the bank.</span>
</span><span data-line="169"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="170">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
</span><span data-line="171">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="172">        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span></div>

</span><span data-line="173">
<div class="viewcode-block" id="WordBank.add_word">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.WordBank.add_word">[docs]</a>
</span><span data-line="174">    <span class="k">def</span><span class="w"> </span><span class="nf">add_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="175"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a word to the bank if not already present.</span>
</span><span data-line="176">
</span><span data-line="177"><span class="sd">        Args:</span>
</span><span data-line="178"><span class="sd">            word: Word to add (will be lowercased and stripped).</span>
</span><span data-line="179"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="180">        <span class="n">normalized</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span data-line="181">        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">and</span> <span class="n">normalized</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
</span><span data-line="182">            <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span></div>

</span><span data-line="183">
<div class="viewcode-block" id="WordBank.remove_word">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.WordBank.remove_word">[docs]</a>
</span><span data-line="184">    <span class="k">def</span><span class="w"> </span><span class="nf">remove_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="185"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a word from the bank.</span>
</span><span data-line="186">
</span><span data-line="187"><span class="sd">        Args:</span>
</span><span data-line="188"><span class="sd">            word: Word to remove.</span>
</span><span data-line="189"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="190">        <span class="n">normalized</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span data-line="191">        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
</span><span data-line="192">            <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span></div>
</div>

</span><span data-line="193">
</span><span data-line="194">
<div class="viewcode-block" id="Guess">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Guess">[docs]</a>
</span><span data-line="195"><span class="nd">@dataclass</span>
</span><span data-line="196"><span class="k">class</span><span class="w"> </span><span class="nc">Guess</span><span class="p">:</span>
</span><span data-line="197"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a player&#39;s guess attempt.</span>
</span><span data-line="198">
</span><span data-line="199"><span class="sd">    Attributes:</span>
</span><span data-line="200"><span class="sd">        id: Unique identifier for the guess.</span>
</span><span data-line="201"><span class="sd">        player_id: ID of the player who made the guess.</span>
</span><span data-line="202"><span class="sd">        player_name: Name of the player (for display).</span>
</span><span data-line="203"><span class="sd">        guess_text: The guessed word/phrase.</span>
</span><span data-line="204"><span class="sd">        result: Result of the guess (correct/close/wrong).</span>
</span><span data-line="205"><span class="sd">        points_awarded: Points awarded for correct guess.</span>
</span><span data-line="206"><span class="sd">        time_elapsed: Seconds elapsed since round start.</span>
</span><span data-line="207"><span class="sd">        timestamp: When the guess was made.</span>
</span><span data-line="208"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="209">
</span><span data-line="210">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="211">    <span class="n">player_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="212">    <span class="n">player_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="213">    <span class="n">guess_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="214">    <span class="n">result</span><span class="p">:</span> <span class="n">GuessResult</span> <span class="o">=</span> <span class="n">GuessResult</span><span class="o">.</span><span class="n">WRONG</span>
</span><span data-line="215">    <span class="n">points_awarded</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="216">    <span class="n">time_elapsed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span data-line="217">    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span></div>

</span><span data-line="218">
</span><span data-line="219">
<div class="viewcode-block" id="ChatMessage">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.ChatMessage">[docs]</a>
</span><span data-line="220"><span class="nd">@dataclass</span>
</span><span data-line="221"><span class="k">class</span><span class="w"> </span><span class="nc">ChatMessage</span><span class="p">:</span>
</span><span data-line="222"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Chat message for guessing and communication.</span>
</span><span data-line="223">
</span><span data-line="224"><span class="sd">    Attributes:</span>
</span><span data-line="225"><span class="sd">        id: Unique identifier for the message.</span>
</span><span data-line="226"><span class="sd">        message_type: Type of message (guess, system, hint, etc.).</span>
</span><span data-line="227"><span class="sd">        sender_id: ID of the player who sent the message.</span>
</span><span data-line="228"><span class="sd">        sender_name: Name of the sender for display.</span>
</span><span data-line="229"><span class="sd">        content: Message text content.</span>
</span><span data-line="230"><span class="sd">        metadata: Additional data (e.g., points awarded, guess result).</span>
</span><span data-line="231"><span class="sd">        timestamp: When the message was sent.</span>
</span><span data-line="232"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="233">
</span><span data-line="234">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="235">    <span class="n">message_type</span><span class="p">:</span> <span class="n">ChatMessageType</span> <span class="o">=</span> <span class="n">ChatMessageType</span><span class="o">.</span><span class="n">GUESS</span>
</span><span data-line="236">    <span class="n">sender_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="237">    <span class="n">sender_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;System&quot;</span>
</span><span data-line="238">    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="239">    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="240">    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span>
</span><span data-line="241">
<div class="viewcode-block" id="ChatMessage.system">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.ChatMessage.system">[docs]</a>
</span><span data-line="242">    <span class="nd">@classmethod</span>
</span><span data-line="243">    <span class="k">def</span><span class="w"> </span><span class="nf">system</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatMessage</span><span class="p">:</span>
</span><span data-line="244"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a system message.</span>
</span><span data-line="245">
</span><span data-line="246"><span class="sd">        Args:</span>
</span><span data-line="247"><span class="sd">            content: Message text.</span>
</span><span data-line="248"><span class="sd">            **metadata: Additional metadata key-value pairs.</span>
</span><span data-line="249">
</span><span data-line="250"><span class="sd">        Returns:</span>
</span><span data-line="251"><span class="sd">            System chat message.</span>
</span><span data-line="252"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="253">        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">message_type</span><span class="o">=</span><span class="n">ChatMessageType</span><span class="o">.</span><span class="n">SYSTEM</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span data-line="254">
<div class="viewcode-block" id="ChatMessage.hint">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.ChatMessage.hint">[docs]</a>
</span><span data-line="255">    <span class="nd">@classmethod</span>
</span><span data-line="256">    <span class="k">def</span><span class="w"> </span><span class="nf">hint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">player_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatMessage</span><span class="p">:</span>
</span><span data-line="257"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a hint message for close guesses.</span>
</span><span data-line="258">
</span><span data-line="259"><span class="sd">        Args:</span>
</span><span data-line="260"><span class="sd">            player_name: Name of the player who made the close guess.</span>
</span><span data-line="261"><span class="sd">            **metadata: Additional metadata.</span>
</span><span data-line="262">
</span><span data-line="263"><span class="sd">        Returns:</span>
</span><span data-line="264"><span class="sd">            Hint chat message.</span>
</span><span data-line="265"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="266">        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
</span><span data-line="267">            <span class="n">message_type</span><span class="o">=</span><span class="n">ChatMessageType</span><span class="o">.</span><span class="n">HINT</span><span class="p">,</span>
</span><span data-line="268">            <span class="n">sender_name</span><span class="o">=</span><span class="n">player_name</span><span class="p">,</span>
</span><span data-line="269">            <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">player_name</span><span class="si">}</span><span class="s2"> is close!&quot;</span><span class="p">,</span>
</span><span data-line="270">            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="271">        <span class="p">)</span></div>
</div>

</span><span data-line="272">
</span><span data-line="273">
<div class="viewcode-block" id="Round">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round">[docs]</a>
</span><span data-line="274"><span class="nd">@dataclass</span>
</span><span data-line="275"><span class="k">class</span><span class="w"> </span><span class="nc">Round</span><span class="p">:</span>
</span><span data-line="276"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a single game round.</span>
</span><span data-line="277">
</span><span data-line="278"><span class="sd">    Attributes:</span>
</span><span data-line="279"><span class="sd">        id: Unique identifier for the round.</span>
</span><span data-line="280"><span class="sd">        round_number: Sequential round number (1-indexed).</span>
</span><span data-line="281"><span class="sd">        drawer_id: ID of the player drawing this round.</span>
</span><span data-line="282"><span class="sd">        word: The word being drawn (hidden from guessers).</span>
</span><span data-line="283"><span class="sd">        word_hint: Partially revealed word (e.g., &quot;_ _ _ _ _&quot;).</span>
</span><span data-line="284"><span class="sd">        word_options: Three words offered to drawer for selection.</span>
</span><span data-line="285"><span class="sd">        canvas_id: ID of the canvas for this round.</span>
</span><span data-line="286"><span class="sd">        start_time: When the round started.</span>
</span><span data-line="287"><span class="sd">        end_time: When the round ended (or will end).</span>
</span><span data-line="288"><span class="sd">        duration_seconds: Total round duration in seconds.</span>
</span><span data-line="289"><span class="sd">        guesses: All guess attempts made during the round.</span>
</span><span data-line="290"><span class="sd">        chat_messages: All chat messages from the round.</span>
</span><span data-line="291"><span class="sd">        scores: Points awarded to each player this round.</span>
</span><span data-line="292"><span class="sd">        is_active: Whether the round is currently in progress.</span>
</span><span data-line="293"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="294">
</span><span data-line="295">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="296">    <span class="n">round_number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span data-line="297">    <span class="n">drawer_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="298">    <span class="n">word</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="299">    <span class="n">word_hint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="300">    <span class="n">word_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="301">    <span class="n">canvas_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="302">    <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="303">    <span class="n">end_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="304">    <span class="n">duration_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span>
</span><span data-line="305">    <span class="n">guesses</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Guess</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="306">    <span class="n">chat_messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ChatMessage</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="307">    <span class="n">scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># player_id -&gt; points</span>
</span><span data-line="308">    <span class="n">strokes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># Drawing strokes for replay</span>
</span><span data-line="309">    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="310">
<div class="viewcode-block" id="Round.add_stroke">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.add_stroke">[docs]</a>
</span><span data-line="311">    <span class="k">def</span><span class="w"> </span><span class="nf">add_stroke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stroke</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="312"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a drawing stroke to the round.</span>
</span><span data-line="313">
</span><span data-line="314"><span class="sd">        Args:</span>
</span><span data-line="315"><span class="sd">            stroke: Stroke data (color, width, from_x, from_y, to_x, to_y).</span>
</span><span data-line="316"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="317">        <span class="bp">self</span><span class="o">.</span><span class="n">strokes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stroke</span><span class="p">)</span></div>

</span><span data-line="318">
<div class="viewcode-block" id="Round.clear_strokes">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.clear_strokes">[docs]</a>
</span><span data-line="319">    <span class="k">def</span><span class="w"> </span><span class="nf">clear_strokes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="320"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all strokes (when canvas is cleared).&quot;&quot;&quot;</span>
</span><span data-line="321">        <span class="bp">self</span><span class="o">.</span><span class="n">strokes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

</span><span data-line="322">
<div class="viewcode-block" id="Round.start">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.start">[docs]</a>
</span><span data-line="323">    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="324"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the round with the selected word.</span>
</span><span data-line="325">
</span><span data-line="326"><span class="sd">        Args:</span>
</span><span data-line="327"><span class="sd">            word: The word to be drawn.</span>
</span><span data-line="328"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="329">        <span class="bp">self</span><span class="o">.</span><span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span data-line="330">        <span class="bp">self</span><span class="o">.</span><span class="n">word_hint</span> <span class="o">=</span> <span class="s2">&quot;_ &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">)</span>
</span><span data-line="331">        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span data-line="332">        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">duration_seconds</span><span class="p">)</span>
</span><span data-line="333">        <span class="bp">self</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="kc">True</span></div>

</span><span data-line="334">
<div class="viewcode-block" id="Round.end">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.end">[docs]</a>
</span><span data-line="335">    <span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="336"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark the round as ended.&quot;&quot;&quot;</span>
</span><span data-line="337">        <span class="bp">self</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="338">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
</span><span data-line="339">            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span></div>

</span><span data-line="340">
<div class="viewcode-block" id="Round.add_guess">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.add_guess">[docs]</a>
</span><span data-line="341">    <span class="k">def</span><span class="w"> </span><span class="nf">add_guess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guess</span><span class="p">:</span> <span class="n">Guess</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="342"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a guess to the round.</span>
</span><span data-line="343">
</span><span data-line="344"><span class="sd">        Args:</span>
</span><span data-line="345"><span class="sd">            guess: The guess attempt.</span>
</span><span data-line="346"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="347">        <span class="bp">self</span><span class="o">.</span><span class="n">guesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span></div>

</span><span data-line="348">
<div class="viewcode-block" id="Round.add_chat_message">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.add_chat_message">[docs]</a>
</span><span data-line="349">    <span class="k">def</span><span class="w"> </span><span class="nf">add_chat_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">ChatMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="350"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a chat message to the round.</span>
</span><span data-line="351">
</span><span data-line="352"><span class="sd">        Args:</span>
</span><span data-line="353"><span class="sd">            message: The chat message.</span>
</span><span data-line="354"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="355">        <span class="bp">self</span><span class="o">.</span><span class="n">chat_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

</span><span data-line="356">
<div class="viewcode-block" id="Round.calculate_points">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.calculate_points">[docs]</a>
</span><span data-line="357">    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_elapsed</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="358"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate points based on guess time.</span>
</span><span data-line="359">
</span><span data-line="360"><span class="sd">        Faster guesses award more points using exponential decay.</span>
</span><span data-line="361">
</span><span data-line="362"><span class="sd">        Args:</span>
</span><span data-line="363"><span class="sd">            time_elapsed: Seconds since round start.</span>
</span><span data-line="364"><span class="sd">            max_points: Maximum points for instant guess.</span>
</span><span data-line="365">
</span><span data-line="366"><span class="sd">        Returns:</span>
</span><span data-line="367"><span class="sd">            Points to award (100 minimum for correct guess).</span>
</span><span data-line="368"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="369">        <span class="k">if</span> <span class="n">time_elapsed</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="370">            <span class="k">return</span> <span class="n">max_points</span>
</span><span data-line="371">
</span><span data-line="372">        <span class="c1"># Exponential decay: points = max_points * e^(-time/duration)</span>
</span><span data-line="373">        <span class="n">ratio</span> <span class="o">=</span> <span class="n">time_elapsed</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_seconds</span>
</span><span data-line="374">        <span class="n">points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_points</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">))</span>
</span><span data-line="375">        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Minimum 100 points</span></div>

</span><span data-line="376">
<div class="viewcode-block" id="Round.reveal_hint">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.reveal_hint">[docs]</a>
</span><span data-line="377">    <span class="k">def</span><span class="w"> </span><span class="nf">reveal_hint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reveal_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="378"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reveal additional letters in the word hint.</span>
</span><span data-line="379">
</span><span data-line="380"><span class="sd">        Args:</span>
</span><span data-line="381"><span class="sd">            reveal_count: Number of letters to reveal.</span>
</span><span data-line="382">
</span><span data-line="383"><span class="sd">        Returns:</span>
</span><span data-line="384"><span class="sd">            Updated word hint.</span>
</span><span data-line="385"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="386">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">:</span>
</span><span data-line="387">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word_hint</span>
</span><span data-line="388">
</span><span data-line="389">        <span class="c1"># Find unrevealed positions</span>
</span><span data-line="390">        <span class="n">unrevealed</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word_hint</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">]</span>
</span><span data-line="391">
</span><span data-line="392">        <span class="k">if</span> <span class="ow">not</span> <span class="n">unrevealed</span><span class="p">:</span>
</span><span data-line="393">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word_hint</span>
</span><span data-line="394">
</span><span data-line="395">        <span class="c1"># Reveal random positions</span>
</span><span data-line="396">        <span class="n">to_reveal</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">unrevealed</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">reveal_count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unrevealed</span><span class="p">)))</span>
</span><span data-line="397">
</span><span data-line="398">        <span class="n">hint_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">word_hint</span><span class="p">)</span>
</span><span data-line="399">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">to_reveal</span><span class="p">:</span>
</span><span data-line="400">            <span class="n">hint_chars</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span data-line="401">
</span><span data-line="402">        <span class="bp">self</span><span class="o">.</span><span class="n">word_hint</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hint_chars</span><span class="p">)</span>
</span><span data-line="403">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word_hint</span></div>

</span><span data-line="404">
<div class="viewcode-block" id="Round.is_expired">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.is_expired">[docs]</a>
</span><span data-line="405">    <span class="k">def</span><span class="w"> </span><span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="406"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if round time has expired.</span>
</span><span data-line="407">
</span><span data-line="408"><span class="sd">        Returns:</span>
</span><span data-line="409"><span class="sd">            True if current time is past end_time.</span>
</span><span data-line="410"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="411">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
</span><span data-line="412">            <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="413">        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span></div>

</span><span data-line="414">
<div class="viewcode-block" id="Round.time_remaining">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.Round.time_remaining">[docs]</a>
</span><span data-line="415">    <span class="k">def</span><span class="w"> </span><span class="nf">time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span data-line="416"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get remaining time in seconds.</span>
</span><span data-line="417">
</span><span data-line="418"><span class="sd">        Returns:</span>
</span><span data-line="419"><span class="sd">            Seconds remaining, or 0 if expired.</span>
</span><span data-line="420"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="421">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
</span><span data-line="422">            <span class="k">return</span> <span class="mf">0.0</span>
</span><span data-line="423">
</span><span data-line="424">        <span class="n">remaining</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span data-line="425">        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">remaining</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>
</div>

</span><span data-line="426">
</span><span data-line="427">
<div class="viewcode-block" id="GameSettings">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameSettings">[docs]</a>
</span><span data-line="428"><span class="nd">@dataclass</span>
</span><span data-line="429"><span class="k">class</span><span class="w"> </span><span class="nc">GameSettings</span><span class="p">:</span>
</span><span data-line="430"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configurable settings for a game room.</span>
</span><span data-line="431">
</span><span data-line="432"><span class="sd">    Attributes:</span>
</span><span data-line="433"><span class="sd">        id: Unique identifier for settings.</span>
</span><span data-line="434"><span class="sd">        is_public: Whether the room is visible in public lobby list.</span>
</span><span data-line="435"><span class="sd">        round_duration_seconds: Time limit for each round (60-120).</span>
</span><span data-line="436"><span class="sd">        rounds_per_game: Total rounds before game ends.</span>
</span><span data-line="437"><span class="sd">        max_players: Maximum number of players (2-12).</span>
</span><span data-line="438"><span class="sd">        word_bank_ids: IDs of word banks to use.</span>
</span><span data-line="439"><span class="sd">        allow_custom_words: Whether players can add custom words.</span>
</span><span data-line="440"><span class="sd">        custom_words: List of custom words added by players.</span>
</span><span data-line="441"><span class="sd">        custom_words_only: If True, only use custom words (no default word bank).</span>
</span><span data-line="442"><span class="sd">        hints_enabled: Whether to show hints during rounds.</span>
</span><span data-line="443"><span class="sd">        hint_intervals: Seconds between automatic hints.</span>
</span><span data-line="444"><span class="sd">        drawer_points_multiplier: Multiplier for drawer points.</span>
</span><span data-line="445"><span class="sd">        close_guess_threshold: Levenshtein distance for &quot;close&quot; guesses.</span>
</span><span data-line="446"><span class="sd">        require_exact_match: Whether to require exact spelling.</span>
</span><span data-line="447"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="448">
</span><span data-line="449">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="450">    <span class="n">is_public</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Private by default, require room code to join</span>
</span><span data-line="451">    <span class="n">round_duration_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span>
</span><span data-line="452">    <span class="n">rounds_per_game</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
</span><span data-line="453">    <span class="n">max_players</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
</span><span data-line="454">    <span class="n">word_bank_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="455">    <span class="n">allow_custom_words</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="456">    <span class="n">custom_words</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="457">    <span class="n">custom_words_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># If True, only use custom words (no default bank)</span>
</span><span data-line="458">    <span class="n">hints_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="459">    <span class="n">hint_intervals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">])</span>  <span class="c1"># Seconds when to show hints</span>
</span><span data-line="460">    <span class="n">drawer_points_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Drawer gets 50% of points awarded to guessers</span>
</span><span data-line="461">    <span class="n">close_guess_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Max edit distance for &quot;close&quot; hint</span>
</span><span data-line="462">    <span class="n">require_exact_match</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># If false, ignore case/punctuation</span>
</span><span data-line="463">
<div class="viewcode-block" id="GameSettings.add_custom_word">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameSettings.add_custom_word">[docs]</a>
</span><span data-line="464">    <span class="k">def</span><span class="w"> </span><span class="nf">add_custom_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="465"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a custom word to the game.</span>
</span><span data-line="466">
</span><span data-line="467"><span class="sd">        Args:</span>
</span><span data-line="468"><span class="sd">            word: Word to add.</span>
</span><span data-line="469"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="470">        <span class="n">normalized</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span data-line="471">        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">and</span> <span class="n">normalized</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_words</span><span class="p">:</span>
</span><span data-line="472">            <span class="bp">self</span><span class="o">.</span><span class="n">custom_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span></div>

</span><span data-line="473">
<div class="viewcode-block" id="GameSettings.remove_custom_word">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameSettings.remove_custom_word">[docs]</a>
</span><span data-line="474">    <span class="k">def</span><span class="w"> </span><span class="nf">remove_custom_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="475"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a custom word from the game.</span>
</span><span data-line="476">
</span><span data-line="477"><span class="sd">        Args:</span>
</span><span data-line="478"><span class="sd">            word: Word to remove.</span>
</span><span data-line="479"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="480">        <span class="n">normalized</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span data-line="481">        <span class="k">if</span> <span class="n">normalized</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_words</span><span class="p">:</span>
</span><span data-line="482">            <span class="bp">self</span><span class="o">.</span><span class="n">custom_words</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span></div>
</div>

</span><span data-line="483">
</span><span data-line="484">
<div class="viewcode-block" id="GameRoom">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom">[docs]</a>
</span><span data-line="485"><span class="nd">@dataclass</span>
</span><span data-line="486"><span class="k">class</span><span class="w"> </span><span class="nc">GameRoom</span><span class="p">:</span>
</span><span data-line="487"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Game lobby/room for CanvasClash mode.</span>
</span><span data-line="488">
</span><span data-line="489"><span class="sd">    Manages the entire game lifecycle including players, rounds, state transitions,</span>
</span><span data-line="490"><span class="sd">    and game logic.</span>
</span><span data-line="491">
</span><span data-line="492"><span class="sd">    Attributes:</span>
</span><span data-line="493"><span class="sd">        id: Unique identifier for the room.</span>
</span><span data-line="494"><span class="sd">        room_code: Short code for joining (e.g., &quot;ABCD1234&quot;).</span>
</span><span data-line="495"><span class="sd">        name: Display name for the room.</span>
</span><span data-line="496"><span class="sd">        game_mode: Type of game mode.</span>
</span><span data-line="497"><span class="sd">        game_state: Current state of the game.</span>
</span><span data-line="498"><span class="sd">        settings: Game configuration settings.</span>
</span><span data-line="499"><span class="sd">        host_id: ID of the player who created the room.</span>
</span><span data-line="500"><span class="sd">        players: All players in the room (active and disconnected).</span>
</span><span data-line="501"><span class="sd">        current_round: The active round (if any).</span>
</span><span data-line="502"><span class="sd">        round_history: All completed rounds.</span>
</span><span data-line="503"><span class="sd">        current_round_number: Current round index (0-indexed).</span>
</span><span data-line="504"><span class="sd">        canvas_id: ID of the active canvas.</span>
</span><span data-line="505"><span class="sd">        created_at: When the room was created.</span>
</span><span data-line="506"><span class="sd">        started_at: When the game started (left lobby).</span>
</span><span data-line="507"><span class="sd">        ended_at: When the game ended.</span>
</span><span data-line="508"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="509">
</span><span data-line="510">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span><span data-line="511">    <span class="n">room_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="512">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Untitled Game&quot;</span>
</span><span data-line="513">    <span class="n">game_mode</span><span class="p">:</span> <span class="n">GameMode</span> <span class="o">=</span> <span class="n">GameMode</span><span class="o">.</span><span class="n">SKRIBBL</span>
</span><span data-line="514">    <span class="n">game_state</span><span class="p">:</span> <span class="n">GameState</span> <span class="o">=</span> <span class="n">GameState</span><span class="o">.</span><span class="n">LOBBY</span>
</span><span data-line="515">    <span class="n">settings</span><span class="p">:</span> <span class="n">GameSettings</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">GameSettings</span><span class="p">)</span>
</span><span data-line="516">    <span class="n">host_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="517">    <span class="n">players</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Player</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="518">    <span class="n">banned_user_ids</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>  <span class="c1"># User IDs that are banned</span>
</span><span data-line="519">    <span class="n">current_round</span><span class="p">:</span> <span class="n">Round</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="520">    <span class="n">round_history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Round</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="521">    <span class="n">current_round_number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="522">    <span class="n">canvas_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="523">    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span>
</span><span data-line="524">    <span class="n">started_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="525">    <span class="n">ended_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="526">    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</span><span data-line="527">
<div class="viewcode-block" id="GameRoom.__post_init__">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.__post_init__">[docs]</a>
</span><span data-line="528">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="529"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate room code if not provided.&quot;&quot;&quot;</span>
</span><span data-line="530">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">room_code</span><span class="p">:</span>
</span><span data-line="531">            <span class="c1"># Generate 6-character alphanumeric code</span>
</span><span data-line="532">            <span class="bp">self</span><span class="o">.</span><span class="n">room_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span></div>

</span><span data-line="533">
<div class="viewcode-block" id="GameRoom.add_player">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.add_player">[docs]</a>
</span><span data-line="534">    <span class="k">def</span><span class="w"> </span><span class="nf">add_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="n">Player</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="535"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a player to the room.</span>
</span><span data-line="536">
</span><span data-line="537"><span class="sd">        Spectators can join regardless of room capacity or game state (except GAME_OVER).</span>
</span><span data-line="538"><span class="sd">        Regular players can only join in LOBBY state when room is not full.</span>
</span><span data-line="539">
</span><span data-line="540"><span class="sd">        Args:</span>
</span><span data-line="541"><span class="sd">            player: Player to add.</span>
</span><span data-line="542">
</span><span data-line="543"><span class="sd">        Raises:</span>
</span><span data-line="544"><span class="sd">            ValueError: If room is full (non-spectators), banned, or cannot join in current state.</span>
</span><span data-line="545"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="546">        <span class="c1"># Check if user is banned</span>
</span><span data-line="547">        <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">user_id</span> <span class="ow">and</span> <span class="n">player</span><span class="o">.</span><span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">banned_user_ids</span><span class="p">:</span>
</span><span data-line="548">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You have been banned from this room&quot;</span><span class="p">)</span>
</span><span data-line="549">
</span><span data-line="550">        <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">is_spectator</span><span class="p">:</span>
</span><span data-line="551">            <span class="c1"># Spectators can join anytime except game over</span>
</span><span data-line="552">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_state</span> <span class="o">==</span> <span class="n">GameState</span><span class="o">.</span><span class="n">GAME_OVER</span><span class="p">:</span>
</span><span data-line="553">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot spectate: game is over&quot;</span><span class="p">)</span>
</span><span data-line="554">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="555">            <span class="c1"># Regular players have restrictions</span>
</span><span data-line="556">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_guessers</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">max_players</span><span class="p">:</span>
</span><span data-line="557">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room is full&quot;</span><span class="p">)</span>
</span><span data-line="558">
</span><span data-line="559">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">GameState</span><span class="o">.</span><span class="n">LOBBY</span><span class="p">,</span> <span class="n">GameState</span><span class="o">.</span><span class="n">DRAWING</span><span class="p">):</span>
</span><span data-line="560">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot join: game already in progress&quot;</span><span class="p">)</span>
</span><span data-line="561">
</span><span data-line="562">        <span class="c1"># First non-spectator player becomes host</span>
</span><span data-line="563">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">player</span><span class="o">.</span><span class="n">is_spectator</span><span class="p">:</span>
</span><span data-line="564">            <span class="n">player</span><span class="o">.</span><span class="n">is_host</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="565">            <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">id</span>
</span><span data-line="566">
</span><span data-line="567">        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">player</span><span class="p">)</span></div>

</span><span data-line="568">
<div class="viewcode-block" id="GameRoom.remove_player">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.remove_player">[docs]</a>
</span><span data-line="569">    <span class="k">def</span><span class="w"> </span><span class="nf">remove_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="570"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a player from the room.</span>
</span><span data-line="571">
</span><span data-line="572"><span class="sd">        Args:</span>
</span><span data-line="573"><span class="sd">            player_id: ID of player to remove.</span>
</span><span data-line="574"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="575">        <span class="n">player</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_player</span><span class="p">(</span><span class="n">player_id</span><span class="p">)</span>
</span><span data-line="576">        <span class="k">if</span> <span class="n">player</span><span class="p">:</span>
</span><span data-line="577">            <span class="n">player</span><span class="o">.</span><span class="n">connection_state</span> <span class="o">=</span> <span class="n">PlayerState</span><span class="o">.</span><span class="n">LEFT</span>
</span><span data-line="578">
</span><span data-line="579">            <span class="c1"># Transfer host if needed</span>
</span><span data-line="580">            <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">is_host</span><span class="p">:</span>
</span><span data-line="581">                <span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_players</span><span class="p">()</span>
</span><span data-line="582">                <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
</span><span data-line="583">                    <span class="n">active</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_host</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="584">                    <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span> <span class="o">=</span> <span class="n">active</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
</span><span data-line="585">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="586">                    <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span> <span class="o">=</span> <span class="kc">None</span></div>

</span><span data-line="587">
<div class="viewcode-block" id="GameRoom.get_player">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.get_player">[docs]</a>
</span><span data-line="588">    <span class="k">def</span><span class="w"> </span><span class="nf">get_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Player</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="589"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get player by ID.</span>
</span><span data-line="590">
</span><span data-line="591"><span class="sd">        Args:</span>
</span><span data-line="592"><span class="sd">            player_id: Player ID to find.</span>
</span><span data-line="593">
</span><span data-line="594"><span class="sd">        Returns:</span>
</span><span data-line="595"><span class="sd">            Player if found, None otherwise.</span>
</span><span data-line="596"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="597">        <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">player_id</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span data-line="598">
<div class="viewcode-block" id="GameRoom.active_players">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.active_players">[docs]</a>
</span><span data-line="599">    <span class="k">def</span><span class="w"> </span><span class="nf">active_players</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Player</span><span class="p">]:</span>
</span><span data-line="600"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all connected players (including spectators).</span>
</span><span data-line="601">
</span><span data-line="602"><span class="sd">        Returns:</span>
</span><span data-line="603"><span class="sd">            List of players with CONNECTED state.</span>
</span><span data-line="604"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="605">        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">connection_state</span> <span class="o">==</span> <span class="n">PlayerState</span><span class="o">.</span><span class="n">CONNECTED</span><span class="p">]</span></div>

</span><span data-line="606">
<div class="viewcode-block" id="GameRoom.active_guessers">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.active_guessers">[docs]</a>
</span><span data-line="607">    <span class="k">def</span><span class="w"> </span><span class="nf">active_guessers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Player</span><span class="p">]:</span>
</span><span data-line="608"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all connected non-spectator players (those who can draw/guess).</span>
</span><span data-line="609">
</span><span data-line="610"><span class="sd">        Returns:</span>
</span><span data-line="611"><span class="sd">            List of connected players who are not spectators.</span>
</span><span data-line="612"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="613">        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">connection_state</span> <span class="o">==</span> <span class="n">PlayerState</span><span class="o">.</span><span class="n">CONNECTED</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_spectator</span><span class="p">]</span></div>

</span><span data-line="614">
<div class="viewcode-block" id="GameRoom.spectators">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.spectators">[docs]</a>
</span><span data-line="615">    <span class="k">def</span><span class="w"> </span><span class="nf">spectators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Player</span><span class="p">]:</span>
</span><span data-line="616"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all connected spectators.</span>
</span><span data-line="617">
</span><span data-line="618"><span class="sd">        Returns:</span>
</span><span data-line="619"><span class="sd">            List of connected players who are spectators.</span>
</span><span data-line="620"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="621">        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">connection_state</span> <span class="o">==</span> <span class="n">PlayerState</span><span class="o">.</span><span class="n">CONNECTED</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">is_spectator</span><span class="p">]</span></div>

</span><span data-line="622">
<div class="viewcode-block" id="GameRoom.start_game">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.start_game">[docs]</a>
</span><span data-line="623">    <span class="k">def</span><span class="w"> </span><span class="nf">start_game</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="624"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the game, transitioning from LOBBY to first round.&quot;&quot;&quot;</span>
</span><span data-line="625">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_state</span> <span class="o">!=</span> <span class="n">GameState</span><span class="o">.</span><span class="n">LOBBY</span><span class="p">:</span>
</span><span data-line="626">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Game already started&quot;</span><span class="p">)</span>
</span><span data-line="627">
</span><span data-line="628">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_guessers</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span data-line="629">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need at least 2 players to start&quot;</span><span class="p">)</span>
</span><span data-line="630">
</span><span data-line="631">        <span class="bp">self</span><span class="o">.</span><span class="n">started_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span data-line="632">        <span class="bp">self</span><span class="o">.</span><span class="n">game_state</span> <span class="o">=</span> <span class="n">GameState</span><span class="o">.</span><span class="n">WORD_SELECTION</span>
</span><span data-line="633">        <span class="bp">self</span><span class="o">.</span><span class="n">current_round_number</span> <span class="o">=</span> <span class="mi">0</span></div>

</span><span data-line="634">
<div class="viewcode-block" id="GameRoom.next_round">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.next_round">[docs]</a>
</span><span data-line="635">    <span class="k">def</span><span class="w"> </span><span class="nf">next_round</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Round</span><span class="p">:</span>
</span><span data-line="636"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and start the next round.</span>
</span><span data-line="637">
</span><span data-line="638"><span class="sd">        Returns:</span>
</span><span data-line="639"><span class="sd">            The new round instance.</span>
</span><span data-line="640">
</span><span data-line="641"><span class="sd">        Raises:</span>
</span><span data-line="642"><span class="sd">            ValueError: If game is over or not in correct state.</span>
</span><span data-line="643"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="644">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_round_number</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">rounds_per_game</span><span class="p">:</span>
</span><span data-line="645">            <span class="bp">self</span><span class="o">.</span><span class="n">game_state</span> <span class="o">=</span> <span class="n">GameState</span><span class="o">.</span><span class="n">GAME_OVER</span>
</span><span data-line="646">            <span class="bp">self</span><span class="o">.</span><span class="n">ended_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span data-line="647">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Game is over&quot;</span><span class="p">)</span>
</span><span data-line="648">
</span><span data-line="649">        <span class="c1"># Get next drawer (round-robin from non-spectators only)</span>
</span><span data-line="650">        <span class="n">guessers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_guessers</span><span class="p">()</span>
</span><span data-line="651">        <span class="k">if</span> <span class="ow">not</span> <span class="n">guessers</span><span class="p">:</span>
</span><span data-line="652">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No active players&quot;</span><span class="p">)</span>
</span><span data-line="653">
</span><span data-line="654">        <span class="n">drawer</span> <span class="o">=</span> <span class="n">guessers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_round_number</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">guessers</span><span class="p">)]</span>
</span><span data-line="655">
</span><span data-line="656">        <span class="c1"># Reset player round state (only for guessers)</span>
</span><span data-line="657">        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">guessers</span><span class="p">:</span>
</span><span data-line="658">            <span class="n">player</span><span class="o">.</span><span class="n">reset_round_state</span><span class="p">()</span>
</span><span data-line="659">
</span><span data-line="660">        <span class="c1"># Create new round</span>
</span><span data-line="661">        <span class="n">new_round</span> <span class="o">=</span> <span class="n">Round</span><span class="p">(</span>
</span><span data-line="662">            <span class="n">round_number</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_round_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span data-line="663">            <span class="n">drawer_id</span><span class="o">=</span><span class="n">drawer</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span data-line="664">            <span class="n">duration_seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">round_duration_seconds</span><span class="p">,</span>
</span><span data-line="665">            <span class="n">canvas_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_id</span> <span class="ow">or</span> <span class="n">uuid4</span><span class="p">(),</span>
</span><span data-line="666">        <span class="p">)</span>
</span><span data-line="667">
</span><span data-line="668">        <span class="bp">self</span><span class="o">.</span><span class="n">current_round</span> <span class="o">=</span> <span class="n">new_round</span>
</span><span data-line="669">        <span class="bp">self</span><span class="o">.</span><span class="n">game_state</span> <span class="o">=</span> <span class="n">GameState</span><span class="o">.</span><span class="n">WORD_SELECTION</span>
</span><span data-line="670">
</span><span data-line="671">        <span class="k">return</span> <span class="n">new_round</span></div>

</span><span data-line="672">
<div class="viewcode-block" id="GameRoom.end_round">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.end_round">[docs]</a>
</span><span data-line="673">    <span class="k">def</span><span class="w"> </span><span class="nf">end_round</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="674"><span class="w">        </span><span class="sd">&quot;&quot;&quot;End the current round and update game state.&quot;&quot;&quot;</span>
</span><span data-line="675">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_round</span><span class="p">:</span>
</span><span data-line="676">            <span class="k">return</span>
</span><span data-line="677">
</span><span data-line="678">        <span class="bp">self</span><span class="o">.</span><span class="n">current_round</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</span><span data-line="679">        <span class="bp">self</span><span class="o">.</span><span class="n">round_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_round</span><span class="p">)</span>
</span><span data-line="680">        <span class="bp">self</span><span class="o">.</span><span class="n">game_state</span> <span class="o">=</span> <span class="n">GameState</span><span class="o">.</span><span class="n">ROUND_END</span>
</span><span data-line="681">        <span class="bp">self</span><span class="o">.</span><span class="n">current_round_number</span> <span class="o">+=</span> <span class="mi">1</span></div>

</span><span data-line="682">
<div class="viewcode-block" id="GameRoom.get_leaderboard">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.get_leaderboard">[docs]</a>
</span><span data-line="683">    <span class="k">def</span><span class="w"> </span><span class="nf">get_leaderboard</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Player</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span data-line="684"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get sorted leaderboard of players and scores (excludes spectators).</span>
</span><span data-line="685">
</span><span data-line="686"><span class="sd">        Returns:</span>
</span><span data-line="687"><span class="sd">            List of (player, score) tuples sorted by score descending.</span>
</span><span data-line="688"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="689">        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span data-line="690">            <span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">score</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_guessers</span><span class="p">()],</span>
</span><span data-line="691">            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span data-line="692">            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="693">        <span class="p">)</span></div>

</span><span data-line="694">
<div class="viewcode-block" id="GameRoom.is_game_over">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.is_game_over">[docs]</a>
</span><span data-line="695">    <span class="k">def</span><span class="w"> </span><span class="nf">is_game_over</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="696"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if all rounds are complete.</span>
</span><span data-line="697">
</span><span data-line="698"><span class="sd">        Returns:</span>
</span><span data-line="699"><span class="sd">            True if game is finished.</span>
</span><span data-line="700"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="701">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_round_number</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">rounds_per_game</span></div>

</span><span data-line="702">
<div class="viewcode-block" id="GameRoom.is_host">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.is_host">[docs]</a>
</span><span data-line="703">    <span class="k">def</span><span class="w"> </span><span class="nf">is_host</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="704"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a player is the host.</span>
</span><span data-line="705">
</span><span data-line="706"><span class="sd">        Args:</span>
</span><span data-line="707"><span class="sd">            player_id: Player ID to check.</span>
</span><span data-line="708">
</span><span data-line="709"><span class="sd">        Returns:</span>
</span><span data-line="710"><span class="sd">            True if player is the host.</span>
</span><span data-line="711"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="712">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span> <span class="o">==</span> <span class="n">player_id</span></div>

</span><span data-line="713">
<div class="viewcode-block" id="GameRoom.kick_player">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.kick_player">[docs]</a>
</span><span data-line="714">    <span class="k">def</span><span class="w"> </span><span class="nf">kick_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kicker_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">target_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Player</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="715"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Kick a player from the room (host only).</span>
</span><span data-line="716">
</span><span data-line="717"><span class="sd">        The kicked player can rejoin the room.</span>
</span><span data-line="718">
</span><span data-line="719"><span class="sd">        Args:</span>
</span><span data-line="720"><span class="sd">            kicker_id: ID of the player performing the kick (must be host).</span>
</span><span data-line="721"><span class="sd">            target_id: ID of the player to kick.</span>
</span><span data-line="722">
</span><span data-line="723"><span class="sd">        Returns:</span>
</span><span data-line="724"><span class="sd">            The kicked player, or None if not found or not authorized.</span>
</span><span data-line="725">
</span><span data-line="726"><span class="sd">        Raises:</span>
</span><span data-line="727"><span class="sd">            ValueError: If kicker is not the host or target is the host.</span>
</span><span data-line="728"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="729">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_host</span><span class="p">(</span><span class="n">kicker_id</span><span class="p">):</span>
</span><span data-line="730">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only the host can kick players&quot;</span><span class="p">)</span>
</span><span data-line="731">
</span><span data-line="732">        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_player</span><span class="p">(</span><span class="n">target_id</span><span class="p">)</span>
</span><span data-line="733">        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
</span><span data-line="734">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="735">
</span><span data-line="736">        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">is_host</span><span class="p">:</span>
</span><span data-line="737">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot kick the host&quot;</span><span class="p">)</span>
</span><span data-line="738">
</span><span data-line="739">        <span class="n">target</span><span class="o">.</span><span class="n">connection_state</span> <span class="o">=</span> <span class="n">PlayerState</span><span class="o">.</span><span class="n">LEFT</span>
</span><span data-line="740">        <span class="k">return</span> <span class="n">target</span></div>

</span><span data-line="741">
<div class="viewcode-block" id="GameRoom.ban_player">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.ban_player">[docs]</a>
</span><span data-line="742">    <span class="k">def</span><span class="w"> </span><span class="nf">ban_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banner_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">target_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Player</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="743"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ban a player from the room (host only).</span>
</span><span data-line="744">
</span><span data-line="745"><span class="sd">        The banned player cannot rejoin the room.</span>
</span><span data-line="746">
</span><span data-line="747"><span class="sd">        Args:</span>
</span><span data-line="748"><span class="sd">            banner_id: ID of the player performing the ban (must be host).</span>
</span><span data-line="749"><span class="sd">            target_id: ID of the player to ban.</span>
</span><span data-line="750">
</span><span data-line="751"><span class="sd">        Returns:</span>
</span><span data-line="752"><span class="sd">            The banned player, or None if not found or not authorized.</span>
</span><span data-line="753">
</span><span data-line="754"><span class="sd">        Raises:</span>
</span><span data-line="755"><span class="sd">            ValueError: If banner is not the host or target is the host.</span>
</span><span data-line="756"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="757">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_host</span><span class="p">(</span><span class="n">banner_id</span><span class="p">):</span>
</span><span data-line="758">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only the host can ban players&quot;</span><span class="p">)</span>
</span><span data-line="759">
</span><span data-line="760">        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_player</span><span class="p">(</span><span class="n">target_id</span><span class="p">)</span>
</span><span data-line="761">        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
</span><span data-line="762">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="763">
</span><span data-line="764">        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">is_host</span><span class="p">:</span>
</span><span data-line="765">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot ban the host&quot;</span><span class="p">)</span>
</span><span data-line="766">
</span><span data-line="767">        <span class="c1"># Add to banned list</span>
</span><span data-line="768">        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
</span><span data-line="769">            <span class="bp">self</span><span class="o">.</span><span class="n">banned_user_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span data-line="770">
</span><span data-line="771">        <span class="n">target</span><span class="o">.</span><span class="n">connection_state</span> <span class="o">=</span> <span class="n">PlayerState</span><span class="o">.</span><span class="n">LEFT</span>
</span><span data-line="772">        <span class="k">return</span> <span class="n">target</span></div>

</span><span data-line="773">
<div class="viewcode-block" id="GameRoom.unban_player">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.unban_player">[docs]</a>
</span><span data-line="774">    <span class="k">def</span><span class="w"> </span><span class="nf">unban_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unbanner_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="775"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unban a player from the room (host only).</span>
</span><span data-line="776">
</span><span data-line="777"><span class="sd">        Args:</span>
</span><span data-line="778"><span class="sd">            unbanner_id: ID of the player performing the unban (must be host).</span>
</span><span data-line="779"><span class="sd">            user_id: User ID to unban.</span>
</span><span data-line="780">
</span><span data-line="781"><span class="sd">        Returns:</span>
</span><span data-line="782"><span class="sd">            True if user was unbanned, False if not found in ban list.</span>
</span><span data-line="783">
</span><span data-line="784"><span class="sd">        Raises:</span>
</span><span data-line="785"><span class="sd">            ValueError: If unbanner is not the host.</span>
</span><span data-line="786"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="787">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_host</span><span class="p">(</span><span class="n">unbanner_id</span><span class="p">):</span>
</span><span data-line="788">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only the host can unban players&quot;</span><span class="p">)</span>
</span><span data-line="789">
</span><span data-line="790">        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">banned_user_ids</span><span class="p">:</span>
</span><span data-line="791">            <span class="bp">self</span><span class="o">.</span><span class="n">banned_user_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span data-line="792">            <span class="k">return</span> <span class="kc">True</span>
</span><span data-line="793">        <span class="k">return</span> <span class="kc">False</span></div>

</span><span data-line="794">
<div class="viewcode-block" id="GameRoom.transfer_host">
<a class="viewcode-back" href="../../../api/game.html#scribbl_py.game.models.GameRoom.transfer_host">[docs]</a>
</span><span data-line="795">    <span class="k">def</span><span class="w"> </span><span class="nf">transfer_host</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_host_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">new_host_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="796"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transfer host privileges to another player.</span>
</span><span data-line="797">
</span><span data-line="798"><span class="sd">        Args:</span>
</span><span data-line="799"><span class="sd">            current_host_id: ID of the current host.</span>
</span><span data-line="800"><span class="sd">            new_host_id: ID of the new host.</span>
</span><span data-line="801">
</span><span data-line="802"><span class="sd">        Returns:</span>
</span><span data-line="803"><span class="sd">            True if transfer succeeded, False otherwise.</span>
</span><span data-line="804">
</span><span data-line="805"><span class="sd">        Raises:</span>
</span><span data-line="806"><span class="sd">            ValueError: If current_host_id is not the host.</span>
</span><span data-line="807"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="808">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_host</span><span class="p">(</span><span class="n">current_host_id</span><span class="p">):</span>
</span><span data-line="809">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only the host can transfer host privileges&quot;</span><span class="p">)</span>
</span><span data-line="810">
</span><span data-line="811">        <span class="n">current_host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_player</span><span class="p">(</span><span class="n">current_host_id</span><span class="p">)</span>
</span><span data-line="812">        <span class="n">new_host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_player</span><span class="p">(</span><span class="n">new_host_id</span><span class="p">)</span>
</span><span data-line="813">
</span><span data-line="814">        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_host</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">new_host</span><span class="p">:</span>
</span><span data-line="815">            <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="816">
</span><span data-line="817">        <span class="k">if</span> <span class="n">new_host</span><span class="o">.</span><span class="n">connection_state</span> <span class="o">!=</span> <span class="n">PlayerState</span><span class="o">.</span><span class="n">CONNECTED</span><span class="p">:</span>
</span><span data-line="818">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot transfer host to disconnected player&quot;</span><span class="p">)</span>
</span><span data-line="819">
</span><span data-line="820">        <span class="k">if</span> <span class="n">new_host</span><span class="o">.</span><span class="n">is_spectator</span><span class="p">:</span>
</span><span data-line="821">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot transfer host to a spectator&quot;</span><span class="p">)</span>
</span><span data-line="822">
</span><span data-line="823">        <span class="n">current_host</span><span class="o">.</span><span class="n">is_host</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="824">        <span class="n">new_host</span><span class="o">.</span><span class="n">is_host</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="825">        <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span> <span class="o">=</span> <span class="n">new_host_id</span>
</span><span data-line="826">        <span class="k">return</span> <span class="kc">True</span></div>
</div>

</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Jacob Coffee</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/JacobCoffee/scribbl-py" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=30646c52"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../../_static/shibuya.js?v=c1cf1a6b"></script></body>
</html>